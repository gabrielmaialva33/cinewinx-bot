from io import BytesIO

import aiohttp
from pyrogram import filters, Client
from pyrogram.types import Message

from CineWinx import app
from config import PREFIXES, BANNED_USERS
from strings import get_command


async def make_carbon(code):
    url = "https://carbonara.solopov.dev/api/cook"
    async with aiohttp.ClientSession() as session:
        async with session.post(url, json={"code": code}) as resp:
            image = BytesIO(await resp.read())
    image.name = "carbon.png"
    return image


CARBON_COMMAND = get_command("CARBON_COMMAND")


@app.on_message(filters.command(CARBON_COMMAND, PREFIXES) & ~BANNED_USERS)
async def _carbon(_client: Client, message: Message):
    replied = message.reply_to_message
    if not replied:
        await message.reply_text(
            "ğ—¥ğ—²ğ˜€ğ—½ğ—¼ğ—»ğ—±ğ—® ğ—® ğ˜‚ğ—ºğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º ğ—±ğ—² ğ˜ğ—²ğ˜…ğ˜ğ—¼ ğ—½ğ—®ğ—¿ğ—® ğ—°ğ—¿ğ—¶ğ—®ğ—¿ ğ˜‚ğ—º ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—»."
        )
        return
    if not (replied.text or replied.caption):
        return await message.reply_text(
            "ğ—¥ğ—²ğ˜€ğ—½ğ—¼ğ—»ğ—±ğ—® ğ—® ğ˜‚ğ—ºğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º ğ—±ğ—² ğ˜ğ—²ğ˜…ğ˜ğ—¼ ğ—½ğ—®ğ—¿ğ—® ğ—°ğ—¿ğ—¶ğ—®ğ—¿ ğ˜‚ğ—º ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—»."
        )
    text = await message.reply("ğŸ“‹ ğ—£ğ—¿ğ—¼ğ—°ğ—²ğ˜€ğ˜€ğ—®ğ—»ğ—±ğ—¼...")
    carbon = await make_carbon(replied.text or replied.caption)
    await text.edit("ğŸ“¤ ğ—™ğ—®ğ˜‡ğ—²ğ—»ğ—±ğ—¼ ğ˜‚ğ—½ğ—¹ğ—¼ğ—®ğ—±...")
    await message.reply_photo(carbon)
    await text.delete()
    carbon.close()


__MODULE__ = "ğŸ–¼ï¸ ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—»"
__HELP__ = """
<b>ğŸ–¼ï¸ ğ—–ğ—¼ğ—ºğ—®ğ—»ğ—±ğ—¼ ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—»:</b>

ğ—˜ğ˜€ğ˜ğ—² ğ—°ğ—¼ğ—ºğ—®ğ—»ğ—±ğ—¼ ğ—½ğ—²ğ—¿ğ—ºğ—¶ğ˜ğ—² ğ—®ğ—¼ğ˜€ ğ˜‚ğ˜€ğ˜‚ğ—®Ìğ—¿ğ—¶ğ—¼ğ˜€ ğ—°ğ—¿ğ—¶ğ—®ğ—¿ ğ˜‚ğ—ºğ—® ğ—¶ğ—ºğ—®ğ—´ğ—²ğ—º ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—» ğ—® ğ—½ğ—®ğ—¿ğ˜ğ—¶ğ—¿ ğ—±ğ—² ğ˜‚ğ—ºğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º ğ—±ğ—² ğ˜ğ—²ğ˜…ğ˜ğ—¼. ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—» ğ—²Ì ğ˜‚ğ—ºğ—® ğ—³ğ—²ğ—¿ğ—¿ğ—®ğ—ºğ—²ğ—»ğ˜ğ—® ğ—½ğ—®ğ—¿ğ—® ğ—°ğ—¿ğ—¶ğ—®ğ—¿ ğ—¶ğ—ºğ—®ğ—´ğ—²ğ—»ğ˜€ ğ—¯ğ—²ğ—¹ğ—®ğ˜€ ğ—±ğ—² ğ—°ğ—¼Ìğ—±ğ—¶ğ—´ğ—¼ ğ—³ğ—¼ğ—»ğ˜ğ—².

<b>ğŸ“‹ ğ—™ğ—²ğ—¿ğ—¿ğ—®ğ—ºğ—²ğ—»ğ˜ğ—®ğ˜€:</b>
- ğ—¥ğ—²ğ˜€ğ—½ğ—¼ğ—»ğ—±ğ—® ğ—® ğ˜‚ğ—ºğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º ğ—±ğ—² ğ˜ğ—²ğ˜…ğ˜ğ—¼ ğ—½ğ—®ğ—¿ğ—® ğ—´ğ—²ğ—¿ğ—®ğ—¿ ğ˜‚ğ—ºğ—® ğ—¶ğ—ºğ—®ğ—´ğ—²ğ—º ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—» ğ—® ğ—½ğ—®ğ—¿ğ˜ğ—¶ğ—¿ ğ—±ğ—¼ ğ—°ğ—¼ğ—»ğ˜ğ—²ğ˜‚Ìğ—±ğ—¼ ğ—±ğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º.
- ğ—¦ğ˜‚ğ—½ğ—¼ğ—¿ğ˜ğ—® ğ˜ğ—®ğ—»ğ˜ğ—¼ ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—»ğ˜€ ğ—²ğ—º ğ˜ğ—²ğ˜…ğ˜ğ—¼ ğ—¾ğ˜‚ğ—®ğ—»ğ˜ğ—¼ ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—»ğ˜€ ğ—°ğ—¼ğ—º ğ—¹ğ—²ğ—´ğ—²ğ—»ğ—±ğ—®ğ˜€.
- ğ—˜ğ˜…ğ—¶ğ—¯ğ—² ğ˜‚ğ—ºğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º ğ—±ğ—² ğ—½ğ—¿ğ—¼ğ—°ğ—²ğ˜€ğ˜€ğ—®ğ—ºğ—²ğ—»ğ˜ğ—¼ ğ—²ğ—»ğ—¾ğ˜‚ğ—®ğ—»ğ˜ğ—¼ ğ—´ğ—²ğ—¿ğ—® ğ—® ğ—¶ğ—ºğ—®ğ—´ğ—²ğ—º ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—».
- ğ—™ğ—®ğ˜‡ ğ˜‚ğ—½ğ—¹ğ—¼ğ—®ğ—± ğ—±ğ—® ğ—¶ğ—ºğ—®ğ—´ğ—²ğ—º ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—» ğ—´ğ—²ğ—¿ğ—®ğ—±ğ—® ğ—²ğ—º ğ—¿ğ—²ğ˜€ğ—½ğ—¼ğ˜€ğ˜ğ—® ğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º ğ—¼ğ—¿ğ—¶ğ—´ğ—¶ğ—»ğ—®ğ—¹.

<b>ğŸ“‹ ğ—–ğ—¼ğ—ºğ—®ğ—»ğ—±ğ—¼ğ˜€:</b>
â€¢ /carbon: ğ—¥ğ—²ğ˜€ğ—½ğ—¼ğ—»ğ—±ğ—® ğ—® ğ˜‚ğ—ºğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º ğ—±ğ—² ğ˜ğ—²ğ˜…ğ˜ğ—¼ ğ—½ğ—®ğ—¿ğ—® ğ—´ğ—²ğ—¿ğ—®ğ—¿ ğ˜‚ğ—ºğ—® ğ—¶ğ—ºğ—®ğ—´ğ—²ğ—º ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—» ğ—® ğ—½ğ—®ğ—¿ğ˜ğ—¶ğ—¿ ğ—±ğ—¼ ğ—°ğ—¼ğ—»ğ˜ğ—²ğ˜‚Ìğ—±ğ—¼ ğ—±ğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º.

ğŸ“Œ ğ—¡ğ—¼ğ˜ğ—®: ğ—–ğ—²ğ—¿ğ˜ğ—¶ğ—³ğ—¶ğ—¾ğ˜‚ğ—²-ğ˜€ğ—² ğ—±ğ—² ğ—¿ğ—²ğ˜€ğ—½ğ—¼ğ—»ğ—±ğ—²ğ—¿ ğ—® ğ˜‚ğ—ºğ—® ğ—ºğ—²ğ—»ğ˜€ğ—®ğ—´ğ—²ğ—º ğ—±ğ—² ğ˜ğ—²ğ˜…ğ˜ğ—¼ ğ—½ğ—®ğ—¿ğ—® ğ—´ğ—²ğ—¿ğ—®ğ—¿ ğ—® ğ—¶ğ—ºğ—®ğ—´ğ—²ğ—º ğ—–ğ—®ğ—¿ğ—¯ğ—¼ğ—» ğ—°ğ—¼ğ—º ğ˜€ğ˜‚ğ—°ğ—²ğ˜€ğ˜€ğ—¼.
"""
